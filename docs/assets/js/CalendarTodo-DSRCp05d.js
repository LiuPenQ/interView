import{An as p,Ct as i,Dt as W,En as j,Et as X,Jt as E,Kt as Z,Lt as u,Pt as ee,Qt as f,St as D,Tt as te,Vt as ae,_t as T,bt as t,ht as z,ot as x,qt as H,t as y,ut as oe,vt as L,wt as le,yt as $,zt as A}from"./index-Dg7VDjeM.js";var se={class:"page-container"},ne={class:"calendar-todo-container"},re={class:"calendar-section"},de={class:"calendar-header"},ie={class:"month-title"},ue={class:"calendar-grid"},ve=["onClick"],ce={class:"day-number"},pe={key:0,class:"todo-indicator"},he={class:"todo-count"},fe={class:"todo-section"},ge={class:"todo-header"},me={class:"todo-title"},we=["disabled"],_e={key:0,class:"error-message"},ye={class:"todo-list"},ke={key:0,class:"loading-state"},be={key:1,class:"empty-state"},Ce={key:2,class:"todo-items"},De={class:"todo-checkbox"},xe=["checked","onChange","disabled"],Me=["onClick"],Te={class:"todo-title"},$e={key:0,class:"todo-description"},Ve={class:"todo-actions"},Se=["onClick","disabled"],Be=["onClick","disabled"],Fe={class:"form-group"},Ne={class:"form-group"},je=["disabled"],Ee=["disabled"],ze=W({__name:"CalendarTodo",setup(He){const k=a=>`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`,v=f(new Date),h=f([]),n=f(k(new Date)),s=f(!1),c=f(null),_=f(!1),g=f(!1),r=f({id:"",title:"",description:""}),Y=$(()=>{const a=v.value.getFullYear(),e=v.value.getMonth(),l=new Date(a,e,1),o=new Date(a,e+1,0),m=l.getDay(),N=o.getDate(),b=[];for(let d=1;d<=m;d++){const w=new Date(a,e,1-d);b.push({date:w,isCurrentMonth:!1,day:w.getDate()})}for(let d=1;d<=N;d++){const w=new Date(a,e,d);b.push({date:w,isCurrentMonth:!0,day:d})}const R=42-b.length;for(let d=1;d<=R;d++){const w=new Date(a,e+1,d);b.push({date:w,isCurrentMonth:!1,day:w.getDate()})}return b}),U=$(()=>v.value.toLocaleDateString("zh-CN",{year:"numeric",month:"long"})),q=()=>{v.value=new Date(v.value.getFullYear(),v.value.getMonth()-1,1)},I=()=>{v.value=new Date(v.value.getFullYear(),v.value.getMonth()+1,1)},G=()=>{v.value=new Date},J=a=>{n.value=k(a)},M=a=>{const e=k(a);return h.value.filter(l=>l.date===e).length},K=a=>{const e=k(a);return h.value.filter(l=>l.date===e&&l.completed).length},V=()=>{r.value={id:"",title:"",description:""}},S=a=>{r.value={id:a.id,title:a.title,description:a.description},g.value=!0,_.value=!0},P=()=>{V(),g.value=!1,_.value=!0},B=$(()=>n.value?h.value.filter(a=>a.date===n.value):[]),C=(function(){var a=x(function*(e){s.value=!0,c.value=null;try{e?h.value=(yield y.todo.getByDate(e)).data||[]:h.value=(yield y.todo.getAll()).data||[]}catch(l){console.error("加载任务失败:",l),c.value="加载任务失败，请稍后重试",h.value=[]}finally{s.value=!1}});return function(l){return a.apply(this,arguments)}})(),F=(function(){var a=x(function*(){if(!(!r.value.title||!n.value)){s.value=!0,c.value=null;try{if(g.value){const e=h.value.find(l=>l.id===r.value.id);if(!e)throw new Error("任务不存在");yield y.todo.update(r.value.id,{date:e.date,title:r.value.title,description:r.value.description||"",completed:e.completed})}else{const e={date:n.value,title:r.value.title,description:r.value.description||"",completed:!1};yield y.todo.create(e)}yield C(),V(),_.value=!1}catch(e){console.error("保存任务失败:",e),c.value=g.value?"编辑任务失败，请稍后重试":"添加任务失败，请稍后重试"}finally{s.value=!1}}});return function(){return a.apply(this,arguments)}})(),Q=(function(){var a=x(function*(e){const l=h.value.find(o=>o.id===e);if(l){s.value=!0,c.value=null;try{yield y.todo.toggleCompleted(e,!l.completed),yield C()}catch(o){console.error("更新任务状态失败:",o),c.value="更新任务状态失败，请稍后重试"}finally{s.value=!1}}});return function(l){return a.apply(this,arguments)}})(),O=(function(){var a=x(function*(e){s.value=!0,c.value=null;try{yield y.todo.delete(e),yield C()}catch(l){console.error("删除任务失败:",l),c.value="删除任务失败，请稍后重试"}finally{s.value=!1}});return function(l){return a.apply(this,arguments)}})();return Z(n,a=>{}),ee(()=>{C()}),(a,e)=>{const l=ae("Dialog");return u(),i("div",se,[e[13]||(e[13]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 mr-2 inline",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})]),te(" 日历任务管理 ")])],-1)),t("div",ne,[t("div",re,[t("div",de,[t("button",{class:"btn btn-secondary",onClick:q},[...e[4]||(e[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),t("h2",ie,p(U.value),1),t("div",{class:"header-actions"},[t("button",{class:"btn btn-secondary",onClick:G},"今天"),t("button",{class:"btn btn-secondary",onClick:I},[...e[5]||(e[5]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])])]),e[6]||(e[6]=le('<div class="weekdays" data-v-6e201773><div class="weekday" data-v-6e201773>日</div><div class="weekday" data-v-6e201773>一</div><div class="weekday" data-v-6e201773>二</div><div class="weekday" data-v-6e201773>三</div><div class="weekday" data-v-6e201773>四</div><div class="weekday" data-v-6e201773>五</div><div class="weekday" data-v-6e201773>六</div></div>',1)),t("div",ue,[(u(!0),i(L,null,A(Y.value,(o,m)=>(u(),i("div",{key:m,class:j(["calendar-day",{"other-month":!o.isCurrentMonth,selected:n.value===k(o.date),"has-todos":M(o.date)>0}]),onClick:N=>J(o.date)},[t("div",ce,p(o.day),1),M(o.date)>0?(u(),i("div",pe,[t("span",he,p(K(o.date))+"/"+p(M(o.date)),1)])):D("",!0)],10,ve))),128))])]),t("div",fe,[t("div",ge,[t("h2",me,p(n.value?`${n.value} 的任务`:"任务列表"),1),n.value?(u(),i("button",{key:0,class:"btn btn-primary",onClick:P,disabled:s.value},[...e[7]||(e[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])],8,we)):D("",!0)]),c.value?(u(),i("div",_e,[t("p",null,p(c.value),1)])):D("",!0),t("div",ye,[s.value?(u(),i("div",ke,[...e[8]||(e[8]=[t("p",null,"加载中...",-1)])])):B.value.length===0?(u(),i("div",be,[t("p",null,p(n.value?`暂无 ${n.value} 的任务`:"请选择日期添加任务"),1)])):(u(),i("div",Ce,[(u(!0),i(L,null,A(B.value,o=>(u(),i("div",{key:o.id,class:j(["todo-item",{completed:o.completed}])},[t("div",De,[t("input",{type:"checkbox",checked:o.completed,onChange:m=>Q(o.id),disabled:s.value},null,40,xe)]),t("div",{class:"todo-content",onClick:m=>S(o)},[t("h3",Te,p(o.title),1),o.description?(u(),i("p",$e,p(o.description),1)):D("",!0)],8,Me),t("div",Ve,[t("button",{class:"btn btn-secondary btn-sm mr-2",onClick:T(m=>S(o),["stop"]),disabled:s.value},[...e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Se),t("button",{class:"btn btn-danger btn-sm",onClick:T(m=>O(o.id),["stop"]),disabled:s.value},[...e[10]||(e[10]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Be)])],2))),128))]))])])]),X(l,{visible:_.value,title:g.value?"编辑任务":`添加任务 - ${n.value}`,onClose:e[3]||(e[3]=o=>_.value=!1)},{body:H(()=>[t("form",{onSubmit:T(F,["prevent"])},[t("div",Fe,[e[11]||(e[11]=t("label",{for:"todo-title",class:"form-label"},"任务标题",-1)),E(t("input",{id:"todo-title","onUpdate:modelValue":e[0]||(e[0]=o=>r.value.title=o),type:"text",class:"form-input",placeholder:"请输入任务标题",required:""},null,512),[[z,r.value.title]])]),t("div",Ne,[e[12]||(e[12]=t("label",{for:"todo-description",class:"form-label"},"任务描述",-1)),E(t("textarea",{id:"todo-description","onUpdate:modelValue":e[1]||(e[1]=o=>r.value.description=o),class:"form-input",placeholder:"请输入任务描述",rows:"3"},null,512),[[z,r.value.description]])])],32)]),footer:H(()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:e[2]||(e[2]=o=>_.value=!1),disabled:s.value}," 取消 ",8,je),t("button",{type:"button",class:"btn btn-primary",onClick:F,disabled:s.value},p(s.value?g.value?"保存中...":"添加中...":g.value?"保存":"添加任务"),9,Ee)]),_:1},8,["visible","title"])])}}}),Ae=oe(ze,[["__scopeId","data-v-6e201773"]]);export{Ae as default};
